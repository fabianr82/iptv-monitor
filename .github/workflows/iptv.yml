name: IPTV Report (Self-Hosted)

on:
  schedule:
    # Programaci칩n de las tareas autom치ticas
    - cron: "10 13 * * *"     # 08:10 Bogot치 / 13:10 UTC
    - cron: "30 20 * * *"     # 15:30 Bogot치 / 20:30 UTC
    - cron: "30 1 * * *"      # 20:30 Bogot치 (del d칤a anterior) / 01:30 UTC
  workflow_dispatch: {} # Permite ejecutar el workflow manualmente desde GitHub

jobs:
  run:
    # CR칈TICO: Especifica que este job debe usar tu runner autoalojado
    # Aseg칰rate de que las etiquetas coincidan con las que configuraste en tu runner IPTVHostinger
    runs-on: [self-hosted, hostinger, linux] 
    
    steps:
      - name: Checkout repository
        # Descarga el c칩digo del repositorio en la carpeta de trabajo del runner
        uses: actions/checkout@v4
      
      - name: Setup Python
        # Configura el entorno Python 3.11 (debe estar instalado en tu Hostinger)
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      
      - name: Install dependencies
        # Instala la librer칤a requests para hacer peticiones HTTP
        run: pip install requests
        
      - name: Ejecutar verificador
        # El comando se ejecuta desde la ra칤z del repositorio clonado
        # Generar치 'Canales_Caidos.txt' en esa misma ubicaci칩n
        run: python check_iptv.py
        
      # PASO DE DESPLIEGUE A HOSTINGER
      - name: Despliegue de Resumen a Public_html
        # Este paso copia el archivo generado a la ubicaci칩n web final en tu Hostinger
        run: |
          # 游뚿 RUTA CORREGIDA: Usa tu usuario SSH (u660358073) y la ruta exacta de Hostinger
          RUTA_FINAL="/home/u660358073/public_html/public/aaprueba/"
          
          echo "Copiando Canales_Caidos.txt a: ${RUTA_FINAL}"
          cp Canales_Caidos.txt "${RUTA_FINAL}"
          
          # 游눠 Consejo: Para verificar que el archivo est치 en la ruta, puedes agregar:
          # ls -la "${RUTA_FINAL}"
          
      - name: Subir resumen como artefacto de GitHub (Opcional)
        # Sube el archivo de resultado a GitHub para que puedas descargarlo desde la interfaz
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: resumen-canales
          path: Canales_Caidos.txt # Ruta relativa dentro del repositorio
          if-no-files-found: ignore
